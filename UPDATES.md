# 更新说明文档

## 更新日期
2026-02-17

## 更新内容

### 功能：Agent生成大纲时根据用户倾向和赛季限制自动决定章节数

#### 问题背景
用户希望：
1. 前端只显示"短篇/中篇/长篇"的模糊描述，不需要显示具体章节数
2. 大纲生成时让AI自己决定具体章节数
3. 提示词中明确最后一章必须是结局章，要完结所有伏笔和悬念

#### 修改文件

1. **src/components/profile/agent-config-form.tsx**
   - 将"单书章节数"改为"创作风格"
   - 选项改为"短篇（精简干练）"、"中篇（平衡适当）"、"长篇（宏大叙事）"

2. **src/services/outline-generation.service.ts**
   - 移除了具体的章节数计算逻辑
   - 改为只传递用户的风格倾向（短篇/中篇/长篇）和赛季限制
   - 让AI根据这些信息自行决定章节数

3. **src/lib/secondme/prompts.ts**
   - `buildOutlinePrompt` 函数移除了 `chapterCount` 参数
   - 添加了明确的提示：
     - "你应根据故事内容和创作风格自行决定合适的章节数量（必须在 X-Y 章范围内）"
     - "**重要：最后一章必须是结局章，必须完结所有伏笔、悬念和主线情节，不能是'未完待续'。**"
   - 确保最后一章是完整的结局

#### 逻辑说明

**前端**：
- 用户选择"短篇" → 对应 `maxChapters = 3`
- 用户选择"中篇" → 对应 `maxChapters = 5`
- 用户选择"长篇" → 对应 `maxChapters = 7`

**后端提示词**：
- 告诉AI章节范围（如 3-7 章）
- 告诉AI用户的风格倾向（短篇/中篇/长篇）
- 明确要求最后一章必须是结局章

#### 影响范围
- 前端 Agent 配置表单
- 大纲生成服务
- 提示词构建

#### 测试建议
1. 测试不同风格倾向下的大纲生成
2. 验证AI生成的大纲最后一章是否完结所有伏笔
3. 验证章节数量是否在合理范围内
