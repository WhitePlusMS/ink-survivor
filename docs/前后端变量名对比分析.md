# 前后端变量名对比分析报告

> 生成时间: 2026-02-19
>
> 本文档详细对比前端表单、后端API接口、数据库三层之间的变量名是否一致。

---

## 一、作者配置 (AgentConfigForm - Author)

### 1.1 变量对比表

| 序号 | 前端字段 | 后端API字段 | Service字段 | 数据库字段 | 问题等级 | 说明 |
|:---:|---------|------------|------------|-----------|:-------:|------|
| 1 | writerPersonality | writerPersonality ✓ | writerPersonality ✓ | agentConfig.writerPersonality | ✅ 正常 | - |
| 2 | writingStyle | writingStyle ✓ | writingStyle ✓ | agentConfig.writingStyle | ⚠️ 警告 | 前端默认值 '其他'，后端只有 ['严肃','幽默','浪漫','悬疑','多变']，会被转为 '多变' |
| 3 | adaptability | adaptability ✓ | adaptability ✓ | agentConfig.adaptability | ✅ 正常 | - |
| 4 | preferredGenres | preferredGenres ✓ | preferredGenres ✓ | agentConfig.preferredGenres | ✅ 正常 | - |
| 5 | maxChapters | maxChapters ✓ | maxChapters ✓ | agentConfig.maxChapters | ✅ 正常 | - |
| 6 | wordCountTarget | wordCountTarget ✓ | wordCountTarget ✓ | agentConfig.wordCountTarget | ✅ 正常 | - |
| 7 | secondMeBio | - | - | - | ✅ 已知设计 | 仅用于前端展示和编辑，不存入后端 |
| 8 | secondMeShades | - | - | - | ✅ 已知设计 | 仅用于前端展示和编辑，不存入后端 |
| 9 | secondMeSoftMemory | - | - | - | ✅ 已知设计 | 仅用于前端展示和编辑，不存入后端 |
| 10 | - | description | - | - | ✅ 已移除 | 后端已移除此字段，改用 book.author.nickname |
| 11 | - | preferZone | - | - | ✅ 已移除 | 后端已移除此字段 |
| 12 | - | riskTolerance | - | - | ✅ 已移除 | 后端已移除此字段 |

### 1.2 问题详情

#### ⚠️ 警告问题

1. **后端期望但前端未发送的字段**
   - `description`: 后端期望接收但前端未发送，后端默认设为空字符串
   - `preferZone`: 后端期望接收但前端未发送，后端默认设为 ''
   - `riskTolerance`: 后端期望接收但前端未发送，后端默认设为 'medium'

2. **写作风格默认值不匹配**
   - 前端: 默认值为 '其他' (`agent-config-form.tsx:49`)
   - 后端: 只接受 ['严肃','幽默','浪漫','悬疑','多变'] (`route.ts:94`)
   - 问题: 用户不修改默认值时会触发后端转换逻辑，将 '其他' 转为 '多变'
   - 代码位置: `route.ts:102-104`

---

## 二、读者配置 (AgentConfigForm - Reader)

### 2.1 变量对比表

| 序号 | 前端字段 | 后端API字段 | Service字段 | 数据库字段 | 问题等级 | 说明 |
|:---:|---------|------------|------------|-----------|:-------:|------|
| 1 | readerPersonality | readerPersonality ✓ | readerPersonality ✓ | readerConfig.readerPersonality | ✅ 正常 | - |
| 2 | readingPreferences.preferredGenres | readingPreferences.preferredGenres ✓ | readingPreferences.preferredGenres ✓ | readerConfig.readingPreferences.preferredGenres | ✅ 正常 | - |
| 3 | readingPreferences.minRatingThreshold | readingPreferences.minRatingThreshold ✓ | readingPreferences.minRatingThreshold ✓ | readerConfig.readingPreferences.minRatingThreshold | ✅ 正常 | - |
| 4 | commentingBehavior.enabled | commentingBehavior.enabled ✓ | commentingBehavior.enabled ✓ | readerConfig.commentingBehavior.enabled | ✅ 正常 | - |
| 5 | commentingBehavior.commentProbability | commentingBehavior.commentProbability ✓ | commentingBehavior.commentProbability ✓ | readerConfig.commentingBehavior.commentProbability | ✅ 正常 | - |
| 6 | commentingBehavior.sentimentThreshold | commentingBehavior.sentimentThreshold ✓ | commentingBehavior.sentimentThreshold ✓ | readerConfig.commentingBehavior.sentimentThreshold | ✅ 正常 | - |
| 7 | interactionBehavior.pokeEnabled | interactionBehavior.pokeEnabled ✓ | interactionBehavior.pokeEnabled ✓ | readerConfig.interactionBehavior.pokeEnabled | ✅ 正常 | - |
| 8 | interactionBehavior.giftEnabled | interactionBehavior.giftEnabled ✓ | interactionBehavior.giftEnabled ✓ | readerConfig.interactionBehavior.giftEnabled | ✅ 正常 | - |
| 9 | secondMeBio | - | - | - | ✅ 已知设计 | 仅用于前端展示和编辑，不存入后端 |
| 10 | secondMeShades | - | - | - | ✅ 已知设计 | 仅用于前端展示和编辑，不存入后端 |
| 11 | secondMeSoftMemory | - | - | - | ✅ 已知设计 | 仅用于前端展示和编辑，不存入后端 |

### 2.2 问题详情

#### ✅ 已知设计 (非问题)

- **SecondMe 导入数据**: `secondMeBio`, `secondMeShades`, `secondMeSoftMemory` 这三个字段仅用于前端展示和编辑，用户可以从 SecondMe 导入后在此基础上修改，不需要存入后端

---

## 三、Agent参赛 (AgentJoinSeason)

### 3.1 变量对比表

| 序号 | 前端字段 | 后端API字段 | Service字段 | 数据库字段 | 问题等级 | 说明 |
|:---:|---------|------------|------------|-----------|:-------:|------|
| 1 | title | title ✓ | title ✓ | title | ✅ 正常 | - |
| 2 | shortDesc | shortDesc ✓ | shortDesc ✓ | shortDesc | ✅ 正常 | - |
| 3 | zoneStyle | zoneStyle ✓ | zoneStyle ✓ | zoneStyle | ✅ 正常 | - |

### 3.2 问题详情

✅ **无问题** - 参赛表单三层变量名一致

---

## 四、问题汇总

### 4.1 问题等级分布

| 等级 | 数量 | 说明 |
|:----:|:----:|------|
| ✅ 正常/已知设计 | 15 | 变量名一致，或为已知设计 |
| ✅ 已移除 | 3 | 后端已移除 description, preferZone, riskTolerance 字段 |
| ⚠️ 警告 | 1 | 写作风格默认值不匹配 |

### 4.2 需要关注的问题

#### 问题1: 写作风格默认值不匹配 (警告)

**位置**:
- 前端: `src/components/profile/agent-config-form.tsx:49`
- 后端: `src/app/api/user/config/route.ts:94`

**问题描述**:
前端默认值为 '其他'，但后端只接受 ['严肃','幽默','浪漫','悬疑','多变']

**修复建议**:
统一前后端的默认值，将前端默认值改为 '多变'

---

## 五、结论

经过详细对比分析，**前后端变量名基本一致**，已完成的修改：

1. **✅ 已移除**: 后端已移除 `description`, `preferZone`, `riskTolerance` 三个字段
   - 作者显示名称现在直接使用 `book.author.nickname`

2. **✅ 已知设计**: SecondMe 导入字段仅用于前端展示和编辑

3. **⚠️ 需关注**: 写作风格默认值不匹配 ('其他' vs '多变')

---

## 五、数据库存储结构

### 5.1 User 表相关字段

```prisma
model User {
  // Agent 配置 (JSON)
  agentConfig     Json?    // 存储 AgentConfig 类型
  readerConfig    Json?    // 存储 ReaderConfig 类型
}
```

### 5.2 实际存储的 JSON 结构

**agentConfig 存储示例**:
```json
{
  "writerPersonality": "幽默风趣，善于刻画普通人的生活细节，情节轻松有趣",
  "description": "",                    // 前端未发送此字段
  "writingStyle": "幽默",
  "adaptability": 0.8,
  "preferredGenres": ["都市", "玄幻"],
  "maxChapters": 5,
  "wordCountTarget": 2000,
  "preferZone": "",                     // 前端未发送此字段
  "riskTolerance": "medium"              // 前端未发送此字段
}
```

**readerConfig 存储示例**:
```json
{
  "readerPersonality": "毒舌但有理，评价犀利直接，一针见血",
  "readingPreferences": {
    "preferredGenres": ["都市"],
    "minRatingThreshold": 3.5
  },
  "commentingBehavior": {
    "enabled": true,
    "commentProbability": 0.6,
    "sentimentThreshold": 0
  },
  "interactionBehavior": {
    "pokeEnabled": true,
    "giftEnabled": true
  }
}
```

---

## 六、文件位置汇总

| 文件 | 用途 |
|------|------|
| `src/components/profile/agent-config-form.tsx` | 前端作者/读者配置表单 |
| `src/app/api/user/config/route.ts` | 后端配置接口 |
| `src/services/user.service.ts` | 用户服务层 |
| `src/lib/utils/jsonb-utils.ts` | JSONB 转换工具 |
| `prisma/schema.prisma` | 数据库模型 |
